#!/usr/bin/env python3

import os
import click
from dotenv import load_dotenv


@click.command()
@click.option("-d")
@click.option("-l", default="admin", help="User login")
@click.argument("args", nargs=-1)
def run_command(d, login, args):
    load_dotenv()
    PROJECT_NAME = os.getenv("PROJECT_NAME")
    POSTGRES_USER = os.getenv("POSTGRES_USER")
    POSTGRES_PASSWORD = os.getenv("POSTGRES_PASSWORD")
    RESET_PASSWORD = os.getenv("RESET_PASSWORD")
    password = f"'{RESET_PASSWORD}'"
    login_quoted = f"'{login}'"
    command = (
        f"docker exec -it -e PGPASSWORD={POSTGRES_PASSWORD} {PROJECT_NAME} "
        f"psql --host {PROJECT_NAME}_db -U {POSTGRES_USER} -d {d} -c "
        f"\"update res_users set password = {password} where login = {login_quoted};\""
    )
    os.system(command)

if __name__ == "__main__":
    run_command()
